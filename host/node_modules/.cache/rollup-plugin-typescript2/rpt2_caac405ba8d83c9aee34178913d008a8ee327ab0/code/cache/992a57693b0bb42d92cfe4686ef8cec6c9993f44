{"code":"import { Fragment as _Fragment, jsx as _jsx } from \"react/jsx-runtime\";\nimport { tuple } from \"./common\";\nimport { createContext, useContext, useMemo, } from \"react\";\nexport const DataContext = createContext(undefined);\nexport function mkMetaName(name) {\n    return `__structo_meta_${name}`;\n}\nexport function mkMetaValue(meta) {\n    return meta;\n}\nexport function applySelection(rawData, selector) {\n    if (!selector) {\n        return undefined;\n    }\n    let curData = rawData;\n    for (const key of selector.split(\".\")) {\n        curData = curData === null || curData === void 0 ? void 0 : curData[key];\n    }\n    return curData;\n}\nexport function useSelector(selector) {\n    const rawData = useDataEnv();\n    return applySelection(rawData, selector);\n}\nexport function useSelectors(selectors = {}) {\n    const rawData = useDataEnv();\n    return Object.fromEntries(Object.entries(selectors)\n        .filter(([key, selector]) => !!key && !!selector)\n        .map(([key, selector]) => tuple(key, applySelection(rawData, selector))));\n}\nexport function useDataEnv() {\n    return useContext(DataContext);\n}\nexport function DataProvider({ name, data, hidden, advanced, label, children, }) {\n    const parentContext = useDataEnv();\n    const childContext = useMemo(() => {\n        if (!name) {\n            return null;\n        }\n        return {\n            ...parentContext,\n            [name]: data,\n            [mkMetaName(name)]: mkMetaValue({ hidden, advanced, label }),\n        };\n    }, [parentContext, name, data, hidden, advanced, label]);\n    if (childContext === null) {\n        return _jsx(_Fragment, { children: children });\n    }\n    else {\n        return (_jsx(DataContext.Provider, { value: childContext, children: children }));\n    }\n}\nfunction fixCatchallParams(params) {\n    const newParams = {};\n    for (const [key, value] of Object.entries(params)) {\n        if (!value) {\n            continue;\n        }\n        if (key.startsWith(\"...\")) {\n            newParams[key.slice(3)] =\n                typeof value === \"string\"\n                    ? value.replace(/^\\/|\\/$/g, \"\").split(\"/\")\n                    : value;\n        }\n        else {\n            newParams[key] = value;\n        }\n    }\n    return newParams;\n}\nfunction mkPathFromRouteAndParams(route, params) {\n    if (!params) {\n        return route;\n    }\n    let path = route;\n    for (const [key, value] of Object.entries(params)) {\n        if (typeof value === \"string\") {\n            path = path.replace(`[${key}]`, value);\n        }\n        else if (Array.isArray(value)) {\n            if (path.includes(`[[...${key}]]`)) {\n                path = path.replace(`[[...${key}]]`, value.join(\"/\"));\n            }\n            else if (path.includes(`[...${key}]`)) {\n                path = path.replace(`[...${key}]`, value.join(\"/\"));\n            }\n        }\n    }\n    return path;\n}\nexport function PageParamsProvider({ children, route, path: deprecatedRoute, params = {}, query = {}, }) {\n    route = route !== null && route !== void 0 ? route : deprecatedRoute;\n    params = fixCatchallParams(params);\n    const $ctx = useDataEnv() || {};\n    const path = route ? mkPathFromRouteAndParams(route, params) : undefined;\n    return (_jsx(DataProvider, { name: \"pageRoute\", data: route, label: \"Page route\", advanced: true, children: _jsx(DataProvider, { name: \"pagePath\", data: path, label: \"Page path\", children: _jsx(DataProvider, { name: \"params\", data: { ...$ctx.params, ...params }, label: \"Page URL path params\", children: _jsx(DataProvider, { name: \"query\", data: { ...$ctx.query, ...query }, label: \"Page URL query params\", children: children }) }) }) }));\n}\nexport function DataCtxReader({ children, }) {\n    const $ctx = useDataEnv();\n    return children($ctx);\n}\n//# sourceMappingURL=data.js.map","references":["/mnt/c/users/aurob/eproject/structo/node_modules/@types/react/index.d.ts","/mnt/c/users/aurob/eproject/structo/packages/host/src/common.ts","/mnt/c/users/aurob/eproject/structo/node_modules/@types/react/index.d.ts"],"map":"{\"version\":3,\"file\":\"data.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/data.tsx\"],\"names\":[],\"mappings\":\"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\"}"}
